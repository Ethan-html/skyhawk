<!DOCTYPE html>
<html lang="en">
  <head>

    <title>Skyhawk Squadron</title>
    <link rel="icon" type="image/png" href="/media/website/skyhawks_logo_CAP_transparent.png">
    <meta name="description" content="Skyhawk Composite Squadron 47 of the Civil Air Patrol transforms youth into strong leaders through cadet programs, community service, and aerospace education in Delano, Minnesota.">

    <meta charset="utf-8">
    <meta name="language" content="en-US">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="msnbot" content="index,follow">

    <link rel="canonical" href="https://skyhawk-cap.org/">

    <!-- Social Sharing (OG + Twitter) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Home | Skyhawk Composite Squadron">
    <meta property="og:description" content="Skyhawk Composite Squadron 47 of the Civil Air Patrol transforms youth into strong leaders through cadet programs, community service, and aerospace education in Delano, Minnesota.">
    <meta property="og:image" content="https://skyhawk-cap.org/assets/images/webclip.png">
    <meta property="og:url" content="https://skyhawk-cap.org/">
    <meta property="og:locale" content="en_US">
    <meta property="article:author" content="https://www.facebook.com/capnhq/">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="Home | Skyhawk Composite Squadron">
    <meta property="twitter:description" content="Skyhawk Composite Squadron 47 of the Civil Air Patrol transforms youth into strong leaders through cadet programs, community service, and aerospace education in Delano, Minnesota.">
    <meta property="twitter:image" content="https://skyhawk-cap.org/assets/images/webclip.png">

    <!-- Favicon & App Icons -->
    <link rel="apple-touch-icon" href="/assets/images/webclip.png">
    <link rel="manifest" href="/assets/manifest.json">
    <link rel="icon" href="/media/websites/skyhawks_logo_CAP_transparent.png">
    <link rel="shortcut icon" href="/media/websites/skyhawks_logo_CAP_transparent.png" type="image/png">

    <link rel="stylesheet" href="assets/stylesheets/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://skyhawk.cap.gov/core/libraries/jquery/assets/3.3.1/jquery.min.js"></script>
    <script src="assets/js/main-3e47b52a9c95aa9cd957b34befd0acf5.min.js"></script>
    <script src="https://skyhawk.cap.gov/core/public/shared/assets/js/jquery.cycle2/2.1.6/jquery.cycle2-fef2f3645726cce4154911d6140d7d52.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M2RSE2BRK2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-M2RSE2BRK2');
    </script>
    <style>
        /* =========================
        LOGIN PAGE – ISOLATED
        ========================= */

        .login-page {
          min-height: calc(100vh - 200px); /* avoids header/footer overlap */
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 40px 20px;
          background: #f5f7fa;
        }

        .login-card {
          width: 100%;
          max-width: 380px;
          background: #ffffff;
          border-radius: 10px;
          padding: 32px 28px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
          text-align: center;
        }

        /* Logo */
        .login-card img {
          width: 110px;
          margin-bottom: 16px;
        }

        /* Title */
        .login-card h2 {
          font-size: 20px;
          margin-bottom: 20px;
          color: #1a1a1a;
          font-weight: 600;
        }

        /* Inputs */
        .login-card input[type="text"],
        .login-card input[type="email"],
        .login-card input[type="password"] {
          width: 100%;
          padding: 12px 14px;
          margin-bottom: 12px;
          border-radius: 6px;
          border: 1px solid #d0d4d9;
          font-size: 15px;
          background: #fff;
          transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        /* Button */
          .login-card button {
              width: 100%;
              color: #fff;
              display: block;
              border: none;
              padding: 15px 20px;
              border-radius: 25px;
              background: #1161ee;
          }

        /* Error / Status message */
        .login-card .error1 {
          margin-top: 12px;
          font-size: 14px;
        }

        /* Footer text */
        .login-footer {
          margin-top: 18px;
          font-size: 13px;
          color: #666;
        }
          .blue-line1 {
            border: none;           /* remove default border */
            height: 4px;            /* thickness */
            background-color: #001489; /* solid blue */
          }
    </style>
  </head>
  <body>
    <div class="header-section">
      <div data-collapse="medium" data-animation="default" data-duration="400" class="nav-section w-nav">
        <div class="header-contents-wrap">
          <div class="header-container w-container">
            <div class="logo-container">
              <a href="/" class="logo w-clearfix w-nav-brand"> <img src="/assets/images/CAP-2017-logo-horizontal-optimized.png" alt="Skyhawk Composite Squadron" class="logo-image"> </a>
              <h2 class="website-tagline" id="unit-name"></h2>
            </div>
            <div class="header-content-right-wrap">
              <div class="website-logo-container">
                <img src="/media/website/skyhawks_logo_CAP_transparent.png" alt="Skyhawk Composite Squadron" class="website-logo">
              </div>
            </div>
          </div>
        </div>
        <div class="w-nav-overlay" data-wf-ignore=""></div>
      </div>
    </div>
    <div class="blue-line1"></div>
    <div class="login-page">
      <div class="login-card">
        <h2>Login to Your Account</h2>
        <!-- Login Form -->
        <form id="loginForm">
          <input type="email" id="username" placeholder="Email" required>
          <input type="password" id="password" placeholder="Password" required>
          <button type="submit">Login</button>
          <div class="error1" style="display: none;" id="errorMsg"></div>
        </form>

        <!-- Forgot Password Link -->
        <p style="margin-top: 12px;">
          <a href="#" id="forgot-password-link">Forgot your password?</a>
        </p>

        <!-- Password Reset Section (Hidden by default) -->
        <div id="password-reset-section" style="display: none; margin-top: 20px;">
          <p style="font-size: 14px; color: #555;">Enter your email to reset your password:</p>
          <input type="email" id="reset-email" placeholder="Enter your email" style="width: 100%; padding: 12px 14px; border-radius: 6px; border: 1px solid #d0d4d9; margin-bottom: 10px; font-size: 14px;">
          <button id="reset-password-btn" style="width: 100%; padding: 12px; border-radius: 25px; border: none; background: #1161ee; color: #fff; font-weight: 600;">Send Reset Email</button>
          <div id="reset-status" style="margin-top: 8px; font-size: 13px;"></div>
          <p style="margin-top: 12px;"><a href="#" id="back-to-login">Back to login</a></p>
        </div>
        <!-- First Login Section (Hidden by default) -->
        <div id="first-time-section" style="display: none; margin-top: 20px;">
          <input type="email" id="first-time-email" placeholder="Enter your email" style="width: 100%; padding: 12px 14px; border-radius: 6px; border: 1px solid #d0d4d9; margin-bottom: 10px; font-size: 14px;">
          <button id="first-time-reset-btn" style="width: 100%; padding: 12px; border-radius: 25px; border: none; background: #1161ee; color: #fff; font-weight: 600;">Login</button>
          <div id="first-reset-status" style="margin-top: 8px; font-size: 13px;"></div>
        </div>
        <div id="first-time-reset-section" style="display: none; margin-top: 20px;">
          <h4>An <strong>email</strong> has been sent to your inbox to set up your password. (Check your spam folder)</h4>
          <p style="font-size: 14px; color: #555; margin-top: 8px;">
            Once you set your password, return here to log in.
          </p>

          <p style="font-size: 14px; color: #555;">
            Didn't receive it? <a href="#" id="resend-reset-email">Resend email</a>
          </p>

          <button onclick="window.location.href='/login'" 
                  style="margin-top: 12px; padding: 12px 20px; border-radius: 25px; border: none; background: #1161ee; color: #fff; font-weight: 600; cursor: pointer;">
            Login
          </button>
        </div>



        <div class="login-footer">
          <p>Members only</p>
        </div>
      </div>
    </div>
    <div id="footer"></div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
      import { sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged
      } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

      import { initHeaderFooter } from "/assets/js/header-footer.js";


      const firebaseConfig = {
        apiKey: "AIzaSyBk_ikYB1PzkgHx4zJY73pe3EfzQRpZvqw",
        authDomain: "skyhawk-web.firebaseapp.com",
        projectId: "skyhawk-web",
        storageBucket: "skyhawk-web.firebasestorage.app",
        messagingSenderId: "340655139001",
        appId: "1:340655139001:web:7923a1fe83ac4a4c689368",
        measurementId: "G-M2RSE2BRK2"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const form = document.getElementById("loginForm");
      const errorMsg = document.getElementById("errorMsg");
      const params = new URLSearchParams(window.location.search);
      const isNew = params.has('new');
      const newEmail = params.get('new');

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        errorMsg.style.display = "block";
        errorMsg.style.color = "#333";
        errorMsg.textContent = "Signing in…";

        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

          // Check first login
          const { creationTime, lastSignInTime } = user.metadata;
          const isFirstLogin = creationTime === lastSignInTime;

          if (isFirstLogin) {
            // Force password reset via email
            await sendPasswordResetEmail(auth, email);
            alert("A password reset email has been sent. Please check your inbox to set your password.");
            await auth.signOut(); // prevent access until password is reset
            return; // stop further redirect
          }

          // Normal login
          errorMsg.style.color = "green";
          errorMsg.textContent = "Login successful! Redirecting…";

          setTimeout(() => {
            window.location.href = "/"; // or "/member" if that’s your home page
          }, 800);

        } catch (err) {
          errorMsg.style.color = "red";

          switch (err.code) {
            case "auth/user-not-found":
              errorMsg.textContent = "No account found for this email.";
              break;
            case "auth/wrong-password":
              errorMsg.textContent = "Incorrect password.";
              break;
            case "auth/invalid-email":
              errorMsg.textContent = "Invalid email address.";
              break;
            default:
              errorMsg.textContent = "Login failed. Please try again.";
          }
        }
      });
      const loginForm = document.getElementById("loginForm");
      const forgotLink = document.getElementById("forgot-password-link");
      const resetSection = document.getElementById("password-reset-section");
      const firstTimeSection = document.getElementById("first-time-section");
      const backToLogin = document.getElementById("back-to-login");
      const resetEmailInput = document.getElementById("reset-email");
      const firstTimeEmailInput = document.getElementById("first-time-email");
      const resetStatus = document.getElementById("reset-status");
      const resetBtn = document.getElementById("reset-password-btn");
      const firstTimeResetBtn = document.getElementById("first-time-reset-btn");
      const firstResetStatus = document.getElementById("first-reset-status");
      const firstTimeResetSection = document.getElementById("first-time-reset-section");
      const resendResetLink = document.getElementById("resend-reset-email");

      resendResetLink.addEventListener("click", async (e) => {
        e.preventDefault();

        // Use the email from the first-time flow
        const email = firstTimeEmailInput.value.trim() || newEmail;

        if (!email) {
          alert("Missing email address. Please return to login.");
          return;
        }

        resendResetLink.textContent = "Sending…";
        resendResetLink.style.pointerEvents = "none";
        const actionCodeSettings = {
          url: "https://skyhawk-cap.org/login",
          handleCodeInApp: false, // default, but good to be explicit
        };
        try {
          await sendPasswordResetEmail(auth, email, actionCodeSettings);
          resendResetLink.textContent = "Email sent!";
        } catch (err) {
          console.error(err);
          resendResetLink.textContent = "Resend email";
          resendResetLink.style.pointerEvents = "auto";
          alert("Failed to resend email. Please try again.");
        }
      });

      if (isNew) {
        // Hide login form and forgot link
        loginForm.style.display = "none";
        forgotLink.style.display = "none";

        // Show first-time section
        firstTimeSection.style.display = "block";

        // Auto-fill the email input
        const firstTimeEmailInput = firstTimeSection.querySelector('input[type="email"]');
        firstTimeEmailInput.value = newEmail;

        // Focus the email input for convenience
        firstTimeEmailInput.focus();
      }
      forgotLink.addEventListener("click", (e) => {
        e.preventDefault();
        loginForm.style.display = "none";
        forgotLink.style.display = "none";
        resetSection.style.display = "block";
      });

      // Show login, hide reset form
      backToLogin.addEventListener("click", (e) => {
        e.preventDefault();
        resetSection.style.display = "none";
        loginForm.style.display = "block";
        forgotLink.style.display = "inline"; // show link again
        resetStatus.textContent = ""; // clear previous messages
        resetEmailInput.value = "";   // clear email input
      });

      resetBtn.addEventListener("click", async () => {
        const email = resetEmailInput.value.trim();
        if (!email) {
          resetStatus.style.color = "red";
          resetStatus.textContent = "Please enter your email address.";
          return;
        }

        resetStatus.style.color = "#333";
        resetStatus.textContent = "Sending password reset email…";
        const actionCodeSettings = {
          url: "https://skyhawk-cap.org/login",
          handleCodeInApp: false, // default, but good to be explicit
        };
        try {
          await sendPasswordResetEmail(auth, email, actionCodeSettings);
          resetStatus.style.color = "green";
          resetStatus.textContent = "Password reset email sent! Please check your inbox.";
          resetEmailInput.value = "";
        } catch (err) {
          console.error(err);
          resetStatus.style.color = "red";

          switch (err.code) {
            case "auth/user-not-found":
              resetStatus.textContent = "No account found with that email.";
              break;
            case "auth/invalid-email":
              resetStatus.textContent = "Invalid email address.";
              break;
            default:
              resetStatus.textContent = "Failed to send reset email. Please try again later.";
          }
        }
      });
      firstTimeResetBtn.addEventListener("click", async () => {
        const email = firstTimeEmailInput.value.trim();
        if (!email) {
          firstResetStatus.style.color = "red";
          firstResetStatus.textContent = "Please enter your email address.";
          return;
        }

        firstResetStatus.style.color = "#333";
        firstResetStatus.textContent = "Sending password reset email…";

        const actionCodeSettings = {
          url: "https://skyhawk-cap.org/login",
          handleCodeInApp: false, // default, but good to be explicit
        };

        try {
          await sendPasswordResetEmail(auth, email, actionCodeSettings);

          firstTimeSection.style.display = "none";
          firstTimeResetSection.style.display = "block";
        } catch (err) {
          console.error(err);
          firstResetStatus.style.color = "red";

          switch (err.code) {
            case "auth/user-not-found":
              firstResetStatus.textContent = "No account found with that email.";
              break;
            case "auth/invalid-email":
              firstResetStatus.textContent = "Invalid email address.";
              break;
            default:
              firstResetStatus.textContent =
                "Failed to send reset email. Please try again later.";
          }
        }
      });

      onAuthStateChanged(auth, (user) => {
        if (user && !isNew) {
          window.location.href = "/member";
        }
      });



      document.addEventListener("DOMContentLoaded", async () => {await Promise.all([initHeaderFooter(db)]);});
    </script>
  </body>
</html>
