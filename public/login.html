<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="icon" type="image/png" href="/media/website/skyhawks_logo_CAP_transparent.png">
    <link rel="stylesheet" href="assets/stylesheets/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://skyhawk.cap.gov/core/libraries/jquery/assets/3.3.1/jquery.min.js"></script>
    <script src="https://skyhawk.cap.gov/assets/javascripts/main-3e47b52a9c95aa9cd957b34befd0acf5.min.js"></script>
    <script src="https://skyhawk.cap.gov/core/public/shared/assets/js/jquery.cycle2/2.1.6/jquery.cycle2-fef2f3645726cce4154911d6140d7d52.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M2RSE2BRK2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-M2RSE2BRK2');
    </script>
    <script type="module">
         import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
         import {
           initializeFirestore,
           persistentLocalCache,
           persistentMultipleTabManager,
           collection,
           doc,
           getDoc,
           getDocs
         } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

         // --------------------
         // Firebase config
         // --------------------
         const firebaseConfig = {
           apiKey: "AIzaSyBk_ikYB1PzkgHx4zJY73pe3EfzQRpZvqw",
           authDomain: "skyhawk-web.firebaseapp.com",
           projectId: "skyhawk-web",
           storageBucket: "skyhawk-web.firebasestorage.app",
           messagingSenderId: "340655139001",
           appId: "1:340655139001:web:7923a1fe83ac4a4c689368",
           measurementId: "G-M2RSE2BRK2"
         };

         const app = initializeApp(firebaseConfig);
         const db = initializeFirestore(app, {
           cache: persistentLocalCache({
             tabManager: persistentMultipleTabManager()
           })
         });

         // --------------------
         // Cache-first loader
         // --------------------
         async function loadDocOrCache(pathSegments, cacheKey) {
           const cached = localStorage.getItem(cacheKey);
           if (cached) {
             try { return JSON.parse(cached); } catch {}
           }

           try {
             const ref = doc(db, ...pathSegments);
             const snap = await getDoc(ref);
             if (snap.exists()) {
               const data = snap.data();
               localStorage.setItem(cacheKey, JSON.stringify(data));
               return data;
             }
           } catch (err) {
             console.warn(`Failed to load ${pathSegments.join("/")}`, err);
           }
           return null;
         }

         async function loadCollectionOrCache(pathSegments, cacheKey) {
           const cached = localStorage.getItem(cacheKey);
           if (cached) {
             try { return JSON.parse(cached); } catch {}
           }

           try {
             const colRef = collection(db, ...pathSegments);
             const snap = await getDocs(colRef);
             const data = snap.docs.map(d => d.data());
             localStorage.setItem(cacheKey, JSON.stringify(data));
             return data;
           } catch (err) {
             console.warn(`Failed to load collection ${pathSegments.join("/")}`, err);
           }
           return [];
         }

         // --------------------
         // Render functions
         // --------------------
         function renderUnit(unit) {
           if (!unit) return;
           document.title = unit.name;
           const el = document.getElementById("unit-name");
           if (el) el.textContent = `${unit.name} (${unit.designation})`;
         }

         function renderContact(contact) {
           if (!contact) return;
           const addrEl = document.getElementById("address");
           if (addrEl) addrEl.innerHTML = contact.address.replace(/\n/g, "<br>");

           const phoneEl = document.getElementById("phone");
           if (phoneEl) {
             phoneEl.href = `tel:${contact.phone}`;
             phoneEl.textContent = contact.phone;
           }

           const emailEl = document.getElementById("email");
           if (emailEl) {
             emailEl.innerHTML = `<a href="mailto:${contact.email}">${contact.email}</a>`;
           }
         }


         // Footer quick links
         function renderQuickLinks(links) {
           if (!links?.length) return;
           const root = document.getElementById("footer-quick-links");
           if (!root) return;

           links.forEach(link => {
             const li = document.createElement("li");
             li.className = "footer-links-list-item";

             const a = document.createElement("a");
             a.className = "footer-link footer-list-item-link";
             a.href = link.url;
             a.textContent = link.title;
             a.target = link.external === "true" ? "_blank" : "_self";
             if (link.external === "true") a.rel = "noopener noreferrer";

             li.appendChild(a);
             root.appendChild(li);
           });
         }
         // --------------------
        // Render Copywrite Year
        // --------------------
        const el = document.getElementById("copyright-text");
        const year = new Date().getFullYear();

        el.innerHTML = `© ${year} Civil Air Patrol. All rights reserved.`;
         // --------------------
         // INIT
         // --------------------
         document.addEventListener("DOMContentLoaded", async () => {
           // Fire all loads in parallel (cache-first)
           const [unit, contact, quickLinks] = await Promise.all([
             loadDocOrCache(["main", "unit"], "unit"),
             loadDocOrCache(["main", "contact"], "contact"),
             loadCollectionOrCache(["main", "quickLinks", "children"], "quickLinks")
           ]);

           renderUnit(unit);
           renderContact(contact);
           renderQuickLinks(quickLinks);

           // Menu can load in background without blocking DOM
           renderMenu();
         });
      </script>
    <style>
        /* =========================
        LOGIN PAGE – ISOLATED
        ========================= */

        .login-page {
          min-height: calc(100vh - 200px); /* avoids header/footer overlap */
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 40px 20px;
          background: #f5f7fa;
        }

        .login-card {
          width: 100%;
          max-width: 380px;
          background: #ffffff;
          border-radius: 10px;
          padding: 32px 28px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
          text-align: center;
        }

        /* Logo */
        .login-card img {
          width: 110px;
          margin-bottom: 16px;
        }

        /* Title */
        .login-card h2 {
          font-size: 20px;
          margin-bottom: 20px;
          color: #1a1a1a;
          font-weight: 600;
        }

        /* Inputs */
        .login-card input[type="text"],
        .login-card input[type="password"] {
          width: 100%;
          padding: 12px 14px;
          margin-bottom: 12px;
          border-radius: 6px;
          border: 1px solid #d0d4d9;
          font-size: 15px;
          background: #fff;
          transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        /* Button */
          .login-card button {
              width: 100%;
              color: #fff;
              display: block;
              border: none;
              padding: 15px 20px;
              border-radius: 25px;
              background: #1161ee;
          }

          .blue-line {
            width: 100%;       /* full width of parent container */
            height: 5px;       /* thickness of the line */
            background-color: #001489; /* plain blue color */
            border: none;      /* remove any default borders */
            border-radius: 2px; /* optional, slightly rounded ends */
          }



        /* Error / Status message */
        .login-card .error1 {
          margin-top: 12px;
          font-size: 14px;
        }

        /* Footer text */
        .login-footer {
          margin-top: 18px;
          font-size: 13px;
          color: #666;
        }
    </style>
  </head>
  <body>
    <div class="header-section">
      <div data-collapse="medium" data-animation="default" data-duration="400" class="nav-section w-nav">
        <div class="header-contents-wrap">
          <div class="header-container w-container">
            <div class="logo-container">
              <a href="/" class="logo w-clearfix w-nav-brand"> <img src="/assets/images/CAP-2017-logo-horizontal-optimized.png" alt="Skyhawk Composite Squadron" class="logo-image"> </a>
              <h2 class="website-tagline" id="unit-name"></h2>
            </div>
            <div class="header-content-right-wrap">
              <a href="https://www.gocivilairpatrol.com/?form=FUNEALECFQD" id="donations-button" class="donations-btn">
                <div class="donations-btn-image">
                  <div class="donations-btn-ripple"></div>
                  <img src="/assets/images/heart.svg" alt="">
                </div>
                <div class="donations-btn-text">Donate Today</div>
              </a>
              <div class="website-logo-container">
                <img src="/media/website/skyhawks_logo_CAP_transparent.png" alt="Skyhawk Composite Squadron" class="website-logo">
              </div>
            </div>
          </div>
        </div>
        <div class="w-nav-overlay" data-wf-ignore=""></div>
      </div>
    </div>
    <div class="blue-line"></div>
    <div class="login-page">
      <div class="login-card">
        <h2>Login to Your Account</h2>
        <form id="loginForm">
          <input type="text" id="username" placeholder="Email" required>
          <input type="password" id="password" placeholder="Password" required>
          <button type="submit">Login</button>
          <div class="error1" style="display: none;" id="errorMsg"></div>
        </form>
        <div class="login-footer">
          <p>Skyhawk Members only</p>
        </div>
      </div>
    </div>
    <div class="footer-section">
      <div class="middle-footer-div">
        <div class="footer-container">
          <div class="footer-row row">
            <div class="_1 footer-column-wrap">
              <h4 class="footer-column-title">Address</h4>
              <p id="address" class="footer-paragraph"></p>
              <p class="footer-paragraph" x-ms-format-detection="none"><span id="phone"></span></p>
              <p id="email" class="footer-paragraph"></p>
            </div>
            <div class="_3 footer-column-wrap">
              <h4 class="footer-column-title">Mission Statement</h4>
              <div class="footer-paragraph">
                Volunteers serving America's communities, saving lives, and shaping futures.
              </div>
            </div>
            <div class="_2 footer-column-wrap">
              <h4 class="footer-column-title">Quick Links</h4>
              <ul id="footer-quick-links" class="footer-links-list w-list-unstyled"></ul>
            </div>
          </div>
        </div>
        <div class="container footer w-container"></div>
        <div class="footer-signoff-section">
          <div class="bottom-footer-container">
            <div class="footer-signoff-row row w-row">
              <div class="column w-col w-col-9 w-col-stack">
                <div id="copyright-text" class="copyright-text"></div>
                <ul class="footer-signoff-list w-list-unstyled">
                  <li class="footer-signoff-list-item"><a href="https://get.adobe.com/reader/" target="_blank" rel="noopener" class="footer-link">Get Adobe Acrobat Reader</a></li>
                  <li class="footer-signoff-list-item"><a href="https://www.gocivilairpatrol.com/legal-privacy-statement" target="_blank" rel="noopener" class="footer-link">Legal &amp; Privacy Statement</a></li>
                </ul>
              </div>
              <div class="devby column w-clearfix w-col w-col-3 w-col-stack">
                <div class="footer-signoff-grip w-inline-block">
                  <div id="GRIPFooterLogo" style="padding-top: 10px;">
                    <span id="GRIPFooterLogoText" style="color: #919293; font-size: 10px; font-family: Arial, sans-serif; text-transform: uppercase; display: block; text-align: left; font-weight: 700; letter-spacing: 0.02rem;">
                      WEB DEVELOPMENT BY <a href="" target="_blank" rel="noopener noreferrer" style="color: #919293; text-decoration: underline;">ETHAN LARSON</a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged
      } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
      const firebaseConfig = {
        apiKey: "AIzaSyBk_ikYB1PzkgHx4zJY73pe3EfzQRpZvqw",
        authDomain: "skyhawk-web.firebaseapp.com",
        projectId: "skyhawk-web",
        storageBucket: "skyhawk-web.firebasestorage.app",
        messagingSenderId: "340655139001",
        appId: "1:340655139001:web:7923a1fe83ac4a4c689368",
        measurementId: "G-M2RSE2BRK2"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const form = document.getElementById("loginForm");
      const errorMsg = document.getElementById("errorMsg");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        errorMsg.style.display = "block";
        errorMsg.style.color = "#333";
        errorMsg.textContent = "Signing in…";

        try {
          await signInWithEmailAndPassword(auth, email, password);

          errorMsg.style.color = "green";
          errorMsg.textContent = "Login successful! Redirecting…";

          setTimeout(() => {
            window.location.href = "/";
          }, 800);

        } catch (err) {
          errorMsg.style.color = "red";

          switch (err.code) {
            case "auth/user-not-found":
              errorMsg.textContent = "No account found for this email.";
              break;
            case "auth/wrong-password":
              errorMsg.textContent = "Incorrect password.";
              break;
            case "auth/invalid-email":
              errorMsg.textContent = "Invalid email address.";
              break;
            default:
              errorMsg.textContent = "Login failed. Please try again.";
          }
        }
      });

      onAuthStateChanged(auth, (user) => {
        if (user) {
          window.location.href = "/member";
        }
      });
    </script>
  </body>
</html>
