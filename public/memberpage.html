<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <title></title>
      <link rel="icon" type="image/png" href="/media/website/skyhawks_logo_CAP_transparent.png">
      <link rel="stylesheet" href="assets/stylesheets/main.css">

      <script src="https://skyhawk.cap.gov/core/libraries/jquery/assets/3.3.1/jquery.min.js"></script>
      <script src="https://skyhawk.cap.gov/assets/javascripts/main-3e47b52a9c95aa9cd957b34befd0acf5.min.js"></script>
      <script src="https://skyhawk.cap.gov/core/public/shared/assets/js/jquery.cycle2/2.1.6/jquery.cycle2-fef2f3645726cce4154911d6140d7d52.min.js"></script>

<script type="module">
  // ===============================
  // FIREBASE INITIALIZATION
  // ===============================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    initializeFirestore,
    persistentLocalCache,
    persistentMultipleTabManager,
    collection,
    doc,
    getDoc,
    getDocs
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBk_ikYB1PzkgHx4zJY73pe3EfzQRpZvqw",
    authDomain: "skyhawk-web.firebaseapp.com",
    projectId: "skyhawk-web",
    storageBucket: "skyhawk-web.firebasestorage.app",
    messagingSenderId: "340655139001",
    appId: "1:340655139001:web:7923a1fe83ac4a4c689368",
    measurementId: "G-M2RSE2BRK2"
  };

  const app = initializeApp(firebaseConfig);
  const db = initializeFirestore(app, {
    cache: persistentLocalCache({ tabManager: persistentMultipleTabManager() })
  });
  const auth = getAuth();

  // ===============================
  // CACHE-FIRST LOADERS
  // ===============================
  async function loadDocOrCache(pathSegments, cacheKey) {
    const cached = localStorage.getItem(cacheKey);
    if (cached) {
      try { return JSON.parse(cached); } catch {}
    }
    try {
      const ref = doc(db, ...pathSegments);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        const data = snap.data();
        localStorage.setItem(cacheKey, JSON.stringify(data));
        return data;
      }
    } catch (err) {
      console.warn(`Failed to load ${pathSegments.join("/")}`, err);
    }
    return null;
  }

  async function loadCollectionOrCache(pathSegments, cacheKey) {
    const cached = localStorage.getItem(cacheKey);
    if (cached) {
      try { return JSON.parse(cached); } catch {}
    }
    try {
      const colRef = collection(db, ...pathSegments);
      const snap = await getDocs(colRef);
      const data = snap.docs.map(d => d.data());
      localStorage.setItem(cacheKey, JSON.stringify(data));
      return data;
    } catch (err) {
      console.warn(`Failed to load collection ${pathSegments.join("/")}`, err);
    }
    return [];
  }

   async function loadPage(sectionId, onUpdate) {
    const cacheKey = `pageData_${sectionId}`;
    const cachedRaw = localStorage.getItem(cacheKey);

    if (cachedRaw) {
      try { onUpdate(JSON.parse(cachedRaw)); } catch {}
    }

    // ✅ Correct document path
    const pageRef = doc(db, "member", "pages", "children", sectionId);
    const pageSnap = await getDoc(pageRef);

    if (!pageSnap.exists()) return;

    // ✅ Correct children collection path
    const childrenRef = collection(
      db,
      "member",
      "pages",
      "children",
      sectionId,
      "children"
    );

    const childrenSnap = await getDocs(childrenRef);

    const fresh = {
      id: sectionId,
      title: pageSnap.data().title,
      children: {}
    };

    childrenSnap.forEach(c => {
      const d = c.data();
      fresh.children[d.slug] = {
        title: d.title,
        slug: d.slug,
        content: d.content,
        externalUrl: d.externalUrl || null
      };
    });

    if (JSON.stringify(fresh) !== cachedRaw) {
      localStorage.setItem(cacheKey, JSON.stringify(fresh));
      onUpdate(fresh);
    }
  }


  // ===============================
  // RENDER FUNCTIONS
  // ===============================
  function renderPage(pageData) {
    if (!pageData) return;
    const params = new URLSearchParams(location.search);
    const [, childSlug] = (params.get("page") || "").split("/");
    const children = Object.values(pageData.children);
    const active = children.find(c => c.slug === childSlug) || children[0];

    // Side nav
    const sideList = document.getElementById("sideNavList");
    const sideTitle = document.getElementById("sideNavTitleLink");
    sideTitle.textContent = pageData.title;
    sideTitle.href = `/memberpage?page=${pageData.id}`;
    sideList.innerHTML = "";
    children.forEach(c => {
      const li = document.createElement("li");
      li.className = "left-nav-list-item";
      const a = document.createElement("a");
      a.className = "left-nav-list-link";
      a.href = `/memberpage?page=${pageData.id}/${c.slug}`;
      a.textContent = c.title;
      if (c.slug === active.slug) a.classList.add("selected");
      li.append(a, document.createElement("div"));
      sideList.appendChild(li);
    });

    // Content
    document.getElementById("pageTitle").textContent = active.title;
    if (active.externalUrl) {
      location.href = active.externalUrl;
    } else {
      document.getElementById("pageContent").innerHTML = active.content;
    }
  }

  function renderUnit(unit) {
    if (!unit) return;
    document.title = unit.name;
    const el = document.getElementById("unit-name");
    if (el) el.textContent = `${unit.name} (${unit.designation})`;
  }

  function renderContact(contact) {
    if (!contact) return;
    const addrEl = document.getElementById("address");
    if (addrEl) addrEl.innerHTML = contact.address.replace(/\n/g, "<br>");
    const phoneEl = document.getElementById("phone");
    if (phoneEl) { phoneEl.href = `tel:${contact.phone}`; phoneEl.textContent = contact.phone; }
    const emailEl = document.getElementById("email");
    if (emailEl) { emailEl.innerHTML = `<a href="mailto:${contact.email}">${contact.email}</a>`; }
  }

  function renderQuickLinks(links) {
    if (!links?.length) return;
    const root = document.getElementById("footer-quick-links");
    if (!root) return;
    links.forEach(link => {
      const li = document.createElement("li");
      li.className = "footer-links-list-item";
      const a = document.createElement("a");
      a.className = "footer-link footer-list-item-link";
      a.href = link.url;
      a.textContent = link.title;
      a.target = link.external === "true" ? "_blank" : "_self";
      if (link.external === "true") a.rel = "noopener noreferrer";
      li.appendChild(a);
      root.appendChild(li);
    });
  }

  async function renderMenu() {
    const menuRoot = document.getElementById("main-menu");
    if (!menuRoot) return;

    let pagesData = JSON.parse(localStorage.getItem("menuPages") || "null");
    if (pagesData) buildMenu(pagesData, menuRoot);

    try {
      const pagesCollection = collection(db, "main", "menu", "pages");
      const pagesSnap = await getDocs(pagesCollection);
      const pagesWithChildren = await Promise.all(
        pagesSnap.docs.map(async pageDoc => {
          const childrenSnap = await getDocs(collection(pagesCollection, pageDoc.id, "children"));
          return { page: pageDoc.data(), children: childrenSnap.docs.map(d => d.data()) };
        })
      );
      localStorage.setItem("menuPages", JSON.stringify(pagesWithChildren));
      menuRoot.innerHTML = "";
      buildMenu(pagesWithChildren, menuRoot);
    } catch (err) {
      console.warn("Failed to load menu from Firestore", err);
    }
  }
    async function renderMemberMenu() {
      const menuRoot = document.getElementById("member-menu");
      if (!menuRoot) return;

      let pagesData = JSON.parse(localStorage.getItem("menuPagesMember") || "null");
      if (pagesData) buildMenu(pagesData, menuRoot);

      try {
        const pagesCollection = collection(db, "member", "menu", "pages");
        const pagesSnap = await getDocs(pagesCollection);
        const pagesWithChildren = await Promise.all(
          pagesSnap.docs.map(async pageDoc => {
            const childrenSnap = await getDocs(collection(pagesCollection, pageDoc.id, "children"));
            return { page: pageDoc.data(), children: childrenSnap.docs.map(d => d.data()) };
          })
        );
        console.log('Member menu fetched from Firestore:', pagesWithChildren);

        localStorage.setItem("menuPagesMember", JSON.stringify(pagesWithChildren));
        menuRoot.innerHTML = "";
        buildMenu(pagesWithChildren, menuRoot);
      } catch (err) {
        console.warn("Failed to load member menu from Firestore", err);
      }
    }

  function buildMenu(pagesWithChildren, menuRoot) {
    const fragment = document.createDocumentFragment();
    pagesWithChildren.forEach(({ page, children }) => {
      const li = document.createElement("li");
      li.className = "main-li";
      li.id = `menu-item-${page.id || page.title}`;
      const a = document.createElement("a");
      a.href = page.url || "#";
      a.textContent = page.title;
      a.target = "_self";
      a.className = "main-nav-link";
      li.appendChild(a);
      if (children?.length) {
        li.classList.add("has-dropdown");
        const dropdown = document.createElement("div");
        dropdown.className = "dropdown-container";
        const ul = document.createElement("ul");
        ul.className = "dropdown-list";
        children.forEach(child => {
          const cli = document.createElement("li");
          const ca = document.createElement("a");
          ca.href = child.url || "#";
          ca.textContent = child.title;
          ca.target = "_self";
          cli.appendChild(ca);
          ul.appendChild(cli);
        });
        dropdown.appendChild(ul);
        li.appendChild(dropdown);
      }
      fragment.appendChild(li);
    });
    menuRoot.appendChild(fragment);
    if (window.jQuery) {
      jQuery('.main-li.has-dropdown').each(function () {
        const $item = jQuery(this);
        $item.off('mouseenter mouseleave');
        $item.on('mouseenter', () => $item.addClass('open'));
        $item.on('mouseleave', () => $item.removeClass('open'));
      });
    }
  }

  // ===============================
  // AUTH LOGOUT
  // ===============================
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", async () => {
      try { await signOut(auth); window.location.replace("/"); }
      catch (err) { console.error("Logout failed:", err); }
    });
  }

  // ===============================
  // INIT
  // ===============================
  document.addEventListener("DOMContentLoaded", async () => {
    const sectionId = (new URLSearchParams(location.search).get("page") || "").split("/")[0];
    if (sectionId) document.getElementById("pageContent").textContent = "Loading...";
    
    const [unit, contact, quickLinks] = await Promise.all([
      loadDocOrCache(["main", "unit"], "unit"),
      loadDocOrCache(["main", "contact"], "contact"),
      loadCollectionOrCache(["main", "quickLinks", "children"], "quickLinks")
    ]);

    renderUnit(unit);
    renderContact(contact);
    renderQuickLinks(quickLinks);
    
    if (sectionId) loadPage(sectionId, renderPage);

    // Menu loads in background
    renderMenu();
    renderMemberMenu();
  });
</script>

      <style>
.menu-divider {
  height: 3px;
  width: 100%;
  background: linear-gradient(
    to right,
    #001489,
    #c8102e,
    #001489
  );
}




      </style>

   </head>
    <body style="display:none;">
    <script type="module">
      import { getAuth, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

      const auth = getAuth();

      // HARD GATE — no content allowed until auth resolves
      onAuthStateChanged(auth, user => {
        if (!user) {
          // Not logged in → go home
          window.location.replace("/");
        } else {
          // Authenticated → allow page to render
          document.body.style.display = "block";
        }
      });
      </script>

      <div class="header-section">
         <div data-collapse="medium" data-animation="default" data-duration="400" class="nav-section w-nav">
            <div class="header-contents-wrap">
               <div class="header-container w-container">
                  <div class="logo-container">
                     <a href="/" class="logo w-clearfix w-nav-brand"> <img src="/assets/images/CAP-2017-logo-horizontal-optimized.png" alt="Skyhawk Composite Squadron" class="logo-image"> </a>
                     <h2 class="website-tagline" id="unit-name"></h2>
                  </div>
                  <div class="header-content-right-wrap">
                     <button class="donations-btn" id="logoutBtn">Log out</button>

                     <div class="website-logo-container">
                        <img src="/media/website/skyhawks_logo_CAP_transparent.png" alt="Skyhawk Composite Squadron" class="website-logo">
                     </div>
                     <a href="#main-content" class="cms_form_button primary skip-to-main-content sronly">Skip to main content</a>
                  </div>
               </div>
               <nav class="header-menu-wrap">
                  <div class="header-menu-inside-wrap">
                     <div class="nav-container w-container">
                        <nav class="desktop-navigation-menu">
                           <ul class="main-ul" id="main-menu"></ul>
                           <div class="link-block site-share-wrapper w-hidden-medium w-hidden-small w-hidden-tiny">
                              <a href="" class="w-inline-block w--current" id="load-site-share"> <img src="/assets/images/share-icon.png" alt="Share" class="share-icon"> </a>
                              <nav class="nav-drop-list w-dropdown-list">
                                 <a href="mailto:?subject=Sitemap&amp;body=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap" class="nav-drop-list-link">Email this page</a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap&amp;t=Sitemap" class="nav-drop-list-link" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap&amp;t=Sitemap'); return false;" target="_blank">Share on Facebook</a> <a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap&amp;text=" class="nav-drop-list-link" onclick="window.open('https://twitter.com/intent/tweet?text=Sitemap https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap'); return false;" title="Share on X (formerly Twitter)" target="_blank">Share on X</a> <a href="https://www.linkedin.com/sharing/share-offsite?mini=true&amp;summary=Sitemap&amp;source=Civil%20Air%20Patrol&amp;url=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap&amp;subject=Sitemap" class="nav-drop-list-link" onclick="window.open('https://www.linkedin.com/sharing/share-offsite?mini=true&amp;summary=Sitemap&amp;source=Civil%20Air%20Patrol&amp;url=https%3A%2F%2Fskyhawk%2Ecap%2Egov%2Fsitemap&amp;subject=Sitemap'); return false;">Share on LinkedIn</a>
                              </nav>
                           </div>
                        </nav>
                     </div>
                  </div>
               </nav>
               <div class="menu-divider"></div>

               <nav class="header-menu-wrap">
                  <div class="header-menu-inside-wrap">
                     <div class="nav-container w-container">
                        <nav class="desktop-navigation-menu">
                           <ul class="main-ul" id="member-menu"></ul>
                        </nav>
                     </div>
                  </div>
               </nav>
            </div>
            <div class="w-nav-overlay" data-wf-ignore=""></div>
         </div>
      </div>
      <div id="page">
        <div class="inside-content-section section-wrap">
          <div class="inside-content-beckground">
            <div class="inside-row w-row">

              <!-- LEFT NAV -->
              <div class="left-nav-column w-col w-col-3 w-col-stack w-hidden-medium w-hidden-small w-hidden-tiny">
                <div class="left-nav-list-content-wrap">
                  <h2 class="section-title">
                    <a id="sideNavTitleLink"></a>
                  </h2>
                  <nav>
                    <ul id="sideNavList" class="left-nav-list w-list-unstyled"></ul>
                  </nav>
                </div>
              </div>

              <!-- MAIN CONTENT -->
              <div class="main-content-column w-col w-col-9 w-col-stack">

                <!-- BREADCRUMBS -->
                <div class="inside-page-header-content-wrap">
                  <nav>
                    <ol id="breadcrumbList" class="breadcrumb-list w-clearfix w-list-unstyled"></ol>
                  </nav>
                </div>

                <!-- PAGE TITLE -->
                <div class="landing-page-title-wrapper">
                  <h1 id="pageTitle" class="h1-heading"></h1>
                </div>

                <!-- PAGE CONTENT -->
                <div class="inside-row-nested w-row">
                  <div class="main-content-column-nested w-col w-col-12 w-col-stack">
                    <div id="pageContent" class="main-content-wrap nested-content-wrap"></div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer-section">
         <div class="middle-footer-div">
            <div class="footer-container">
               <div class="footer-row row">
                  <div class="_1 footer-column-wrap">
                     <h4 class="footer-column-title">Address</h4>
                     <p id="address" class="footer-paragraph"></p>
                     <p class="footer-paragraph" x-ms-format-detection="none"><span id="phone" class="w-hidden-medium w-hidden-small w-hidden-tiny" x-ms-format-detection="none"></span></p>
                     <p id="email" class="footer-paragraph"></p>
                  </div>
                  <div class="_3 footer-column-wrap">
                     <h4 class="footer-column-title">Mission Statement</h4>
                     <div class="footer-paragraph">
                        Volunteers serving America's communities, saving lives, and shaping futures.
                     </div>
                  </div>
                  <div class="_2 footer-column-wrap">
                    <h4 class="footer-column-title">Quick Links</h4>
                    <ul
                      id="footer-quick-links"
                      class="footer-links-list w-list-unstyled">
                    </ul>
                  </div>

               </div>
            </div>
         </div>
         <div class="container footer w-container"></div>
         <div class="footer-signoff-section">
            <div class="bottom-footer-container">
               <div class="footer-signoff-row row w-row">
                  <div class="column w-col w-col-9 w-col-stack">
                     <div class="copyright-text">
                        © 2026 Civil Air Patrol. All rights reserved.
                     </div>
                     <ul class="footer-signoff-list w-list-unstyled">
                        <li class="footer-signoff-list-item"><a href="https://get.adobe.com/reader/" target="_blank" rel="noopener" class="footer-link">Get Adobe Acrobat Reader</a></li>
                        <li class="footer-signoff-list-item"><a href="https://www.gocivilairpatrol.com/legal-privacy-statement" target="_blank" rel="noopener" class="footer-link">Legal &amp; Privacy Statement</a></li>
                     </ul>
                  </div>
                  <div class="column w-clearfix w-col w-col-3 w-col-stack">
                     <div class="footer-signoff-grip w-inline-block">
                        <div id="GRIPFooterLogo" style="padding-top: 10px;">
                           <span id="GRIPFooterLogoText" style="
                              color: #919293;
                              font-size: 10px;
                              font-family: Arial, sans-serif;
                              text-transform: uppercase;
                              display: block;
                              text-align: left;
                              font-weight: 700;
                              letter-spacing: 0.02rem;
                              ">
                           WEB DEVELOPMENT BY <a href="" target="_blank" rel="noopener noreferrer" style="
                              color: #919293;
                              text-decoration: underline;
                              ">ETHAN LARSON</a>
                           </span>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>